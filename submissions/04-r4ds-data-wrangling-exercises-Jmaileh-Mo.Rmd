---
Author: Mo Jmaileh
title: "Data Wrangling Exercises"
output: github_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, eval = FALSE, message = FALSE)
```


```{r, echo = TRUE, eval = TRUE, warning = FALSE}
library(tidyverse)
```

Also, run `?flights` and `?who` in the console to (re)familiarize yourself with
these datasets.

--- 

### Exercise 1
```{r, echo = TRUE, eval = TRUE, error = TRUE}
people <- tribble(
  ~name,            ~key,     ~value,
  #---------------/---------/--------
  "Ousmane Diaby",    "age",      18,
  "Ousmane Diaby", "height",     196,
  "Ousmane Diaby",    "age",      24,
  "Rich Eldh",        "age",      24,
  "Rich Eldh",     "height",     195
)

people %>% 
  group_by(name, key) %>%
  mutate(id = row_number()) %>%
  spread(key, value)

```


---

### Exercise 2
```{r, echo = TRUE}
preg <- tribble(
  ~pregnant, ~male, ~female,
  #--------/------/---------
  "yes",        NA,      10,
  "no",         20,      12
)
preg %>%
  gather("male", "female", key = "gender", value = "count")
```



---

### Exercise 3
```{r, echo = TRUE, eval = TRUE, warning = TRUE}
tibble(x = c("a,b,c", "d,e,f,g", "h,i,j")) %>% 
  separate(x, c("one", "two", "three"), extra = "merge")
#The warning message states that there are only 3 pieces expected in each of the entries, but in the second column of x, we see an extra letter (g) in it. So the tibble discards this piece in row 2. To fix this, we add another argument for extras.

```

---

### Exercise 4
Both  [`separate()`][G&W 2017, 12.4.1]  and [`unite()`][G&W 2017, 12.4.2] have a
`remove` argument. What does it do? When does setting it to `FALSE` make sense?

Looking at the seperate help page, we see that the remove argument is used to remove input column from an output data frame when set to TRUE. You would want to set it to false if you would like to see the original input column, perhaps to understand where the values came from or what the information you seprated represents. 

---

### Exercise 5
Using the [`who` dataset][G&W 2017, 12.6], calculate the total number of cases
of TB per year for China, India, and Bangladesh, then plot these statistics
over time. What do you notice that's surprising?

**Hint:** Build on this code, which tidies `who`:

```{r, echo = TRUE}
who %>%
  gather(code, value, new_sp_m014:newrel_f65, na.rm = TRUE) %>% 
  mutate(code = gsub("newrel", "new_rel", code)) %>%
  separate(code, c("new", "var", "sexage")) %>% 
  select(-new, -iso2, -iso3) %>% 
  separate(sexage, c("sex", "age"), sep = 1) %>%
  group_by(country, year)%>%
  summarise(Total_cases = sum(value)) %>%
  filter(country %in% c("China", "India", "Bangladesh")) %>%
  ggplot(aes(x = year, y = Total_cases, color = country)) +
  geom_line()

#India sees a huge jump in cases for the year 2007, but than the level drops for the next couple of years to arount 63,000 cases a year. China also sees a jump in the year 2009 and stays at those levels. Bengladesh seems to have a more steady rise in comparison to the other countries.
```


---

### Exercise 6
Begin by following these steps:

1. Join observations in `flights` with those in `weather` by `origin`, `year`,
`month`, `day`, and `hour`.  
2. Bin `wind_gust` and calculate average `dep_delay` for each bin.  
3. Create a bar graph.

What weather conditions make departure delays more likely?
```{r, echo = TRUE}
library(nycflights13)
flights %>%
  inner_join(weather, by = c("origin", "year", "month", "day", "hour")) %>%
  mutate(bin_wind_gust = cut(wind_gust,
                             breaks = seq(0, max(wind_gust, na.rm = TRUE), 5))) %>%
  group_by(bin_wind_gust) %>%
  summarise(avg_delay = mean(dep_delay, na.rm = TRUE)) %>%
  ggplot(aes(bin_wind_gust, avg_delay)) +
  geom_col()
  
# Bases on our graph, the average delay was the largest when gusts were between 35-40 miles per hour. 
```

**Note:** This question is based on [13.4.6 #4][G&W 2017, 13.4.6]. It is designed
to strengthen your ability to merge and analyze relational data with 
[`inner_join()`][G&W 2017, 13.4.2] and [`summarize()`][G&W 2017, 5.6].

[G&W 2017]: http://r4ds.had.co.nz/
[G&W 2017, 5.6]: http://r4ds.had.co.nz/transform.html#grouped-summaries-with-summarise
[G&W 2017, 12]: http://r4ds.had.co.nz/tidy-data.html
[G&W 2017, 12.3.1]: http://r4ds.had.co.nz/tidy-data.html#gathering
[G&W 2017, 12.3.2]: http://r4ds.had.co.nz/tidy-data.html#spreading
[G&W 2017, 12.3.3]: http://r4ds.had.co.nz/tidy-data.html#exercises-22
[G&W 2017, 12.4.1]: http://r4ds.had.co.nz/tidy-data.html#separate
[G&W 2017, 12.4.2]: http://r4ds.had.co.nz/tidy-data.html#unite
[G&W 2017, 12.4.3]: http://r4ds.had.co.nz/tidy-data.html#exercises-23
[G&W 2017, 12.6]: http://r4ds.had.co.nz/tidy-data.html#case-study
[G&W 2017, 12.6.1]: http://r4ds.had.co.nz/tidy-data.html#exercises-25
[G&W 2017, 13]: http://r4ds.had.co.nz/relational-data.html
[G&W 2017, 13.4.2]: http://r4ds.had.co.nz/relational-data.html#inner-join
[G&W 2017, 13.4.6]: http://r4ds.had.co.nz/relational-data.html#exercises-28